<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Simple Example of generic call completion</TITLE>
<META NAME="description" CONTENT="Simple Example of generic call completion">
<META NAME="keywords" CONTENT="asterisk">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="asterisk.css">

<LINK REL="previous" HREF="node373.html">
<LINK REL="up" HREF="node361.html">
<LINK REL="next" HREF="node375.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html5765"
  HREF="node375.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html5761"
  HREF="node361.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html5757"
  HREF="node373.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html5763"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html5766"
  HREF="node375.html">Packet Loss Concealment</A>
<B> Up:</B> <A NAME="tex2html5762"
  HREF="node361.html">Call Completion Supplementary Services</A>
<B> Previous:</B> <A NAME="tex2html5758"
  HREF="node373.html">Miscellaneous Information and Tips</A>
 &nbsp; <B>  <A NAME="tex2html5764"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION002160000000000000000">
Simple Example of generic call completion</A>
</H1>

<P>
The following is an incredibly bare-bones example sip.conf
and dialplan to show basic usage of generic call completion.
It is likely that if you have a more complex setup, you will
need to make use of items like the CALLCOMPLETION dialplan
function or the CC_INTERFACES channel variable.

<P>
First, let's establish a very simple sip.conf to use for this

<P>
<PRE>
[Mark]
context=phone_calls
cc_agent_policy=generic
cc_monitor_policy=generic
;We will accept defaults for the rest of the cc parameters
;We also are not concerned with other SIP details for this
;example

[Richard]
context=phone_calls
cc_agent_policy=generic
cc_monitor_policy=generic
</PRE>

<P>
Now, let's write a simple dialplan

<P>
<PRE>
[phone_calls]

exten =&gt; 1000,1,Dial(SIP/Mark,20)
exten =&gt; 1000,n,Hangup

exten =&gt; 2000,1,Dial(SIP/Richard,20)
exten =&gt; 2000,n,Hangup

exten =&gt; 30,1,CallCompletionRequest
exten =&gt; 30,n,Hangup

exten =&gt; 31,1,CallCompletionCancel
exten =&gt; 31,n,Hangup
</PRE>

<P>

<UL>
<LI>Scenario 1:
Mark picks up his phone and dials Richard by dialing 2000. Richard is
currently on a call, so Mark hears a busy signal. Mark then hangs up,
picks up the phone and dials 30 to call the CallCompletionRequest
application. After some time, Richard finishes his call and hangs up.
Mark is automatically called back by Asterisk. When Mark picks up his
phone, Asterisk will dial extension 2000 for him.

<P>
</LI>
<LI>Scenario 2:
Richard picks up his phone and dials Mark by dialing 1000. Mark has stepped
away from his desk, and so he is unable to answer the phone within the
20 second dial timeout. Richard hangs up, picks the phone back up and then
dials 30 to request call completion. Mark gets back to his desk and dials
somebody's number. When Mark finishes the call, Asterisk detects that Mark's
phone has had some activity and has become available again and rings Richard's
phone. Once Richard picks up, Asterisk automatically dials exteision 1000 for
him.

<P>
</LI>
<LI>Scenario 3:
Much like scenario 1, Mark calls Richard and Richard is busy. Mark hangs up,
picks the phone back up and then dials 30 to request call completion. After
a little while, Mark realizes he doesn't actually need to talk to Richard, so
he dials 31 to cancel call completion. When Richard becomes free, Mark will
not automatically be redialed by Asterisk.

<P>
</LI>
<LI>Scenario 4:
Richard calls Mark, but Mark is busy. About thirty seconds later, Richard decides
that he should perhaps request call completion. However, since Richard's phone
has the default cc_offer_timer of 20 seconds, he has run out of time to
request call completion. He instead must attempt to dial Mark again manually. If
Mark is still busy, Richard can attempt to request call completion on this second
call instead.

<P>
</LI>
<LI>Scenario 5:
Mark calls Richard, and Richard is busy. Mark requests call completion. Richard
does not finish his current call for another 2 hours (7200 seconds). Since Mark
has the default ccbs_available_timer of 4800 seconds set, Mark will not be
automatically recalled by Asterisk when Richard finishes his call.

<P>
</LI>
<LI>Scenario 6:
Mark calls Richard, and Richard does not respond within the 20 second dial timeout.
Mark requests call completion. Richard does not use his phone again for another
4 hours (144000 seconds). Since Mark has the default ccnr_available_timer
of 7200 seconds set, Mark will not be automatically recalled by Asterisk when
Richard finishes his call.
</LI>
</UL>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html5765"
  HREF="node375.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html5761"
  HREF="node361.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html5757"
  HREF="node373.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html5763"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html5766"
  HREF="node375.html">Packet Loss Concealment</A>
<B> Up:</B> <A NAME="tex2html5762"
  HREF="node361.html">Call Completion Supplementary Services</A>
<B> Previous:</B> <A NAME="tex2html5758"
  HREF="node373.html">Miscellaneous Information and Tips</A>
 &nbsp; <B>  <A NAME="tex2html5764"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
lmadsen
2010-10-21
</ADDRESS>
</BODY>
</HTML>
